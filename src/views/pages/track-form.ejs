<%- layout('layouts/main') %>
<title>Nexus Logistics | Smart Delivery Tracking</title>

<style>
  :root {
    --primary-color: #0d6efd;
    --primary-dark: #0b5ed7;
    --secondary-color: #6f42c1;
    --accent-color: #20c997;
    --dark-color: #212529;
    --light-color: #f8f9fa;
    --glass-bg: rgba(255, 255, 255, 0.85);
    --glass-border: rgba(255, 255, 255, 0.2);
  }

  /* Modern Glass Effect */
  .glass-card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.6);
  }

  /* Background Pattern */
  .bg-pattern {
    background-image: radial-gradient(
        circle at 10% 20%,
        rgba(13, 109, 253, 0.44) 0%,
        transparent 15%
      ),
      radial-gradient(
        circle at 90% 80%,
        rgba(110, 66, 193, 0.456) 0%,
        transparent 15%
      ),
      linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.959) 0%,
        rgba(248, 249, 250, 0.95) 100%
      );
    background-attachment: fixed;
  }

  /* Compact Tracking Container */
  .tracking-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem 0;
  }

  /* Enhanced Input Group */
  .input-group-enhanced {
    box-shadow: 0 8px 32px rgba(13, 110, 253, 0.15);
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid rgba(13, 110, 253, 0.1);
    background: white;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .input-group-enhanced:hover {
    box-shadow: 0 12px 40px rgba(13, 110, 253, 0.2);
    transform: translateY(-2px);
  }

  .tracking-input-enhanced {
    border: none;
    padding: 1.25rem 1.5rem;
    font-size: 1.1rem;
    font-weight: 500;
    background: white;
    border-radius: 16px 0 0 16px;
    letter-spacing: 0.5px;
  }

  .tracking-input-enhanced:focus {
    box-shadow: none;
    background: white;
  }

  .tracking-input-enhanced::placeholder {
    color: #94a3b8;
    font-weight: 400;
  }

  .btn-track-enhanced {
    background: linear-gradient(
      135deg,
      var(--primary-color),
      var(--secondary-color)
    );
    border: none;
    padding: 1.25rem 2.5rem;
    font-weight: 600;
    border-radius: 0 16px 16px 0;
    position: relative;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .btn-track-enhanced:hover {
    background: linear-gradient(135deg, var(--primary-dark), #5a32a3);
    transform: translateX(2px);
  }

  .btn-track-enhanced:active {
    transform: scale(0.98);
  }

  /* Status Badges */
  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(13, 110, 253, 0.1);
    color: var(--primary-color);
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .status-badge i {
    font-size: 0.9rem;
  }

  /* Delivery Stats Cards */
  .stats-card-compact {
    background: white;
    border-radius: 12px;
    padding: 1.25rem;
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
  }

  .stats-card-compact:hover {
    border-color: var(--primary-color);
    box-shadow: 0 8px 24px rgba(13, 110, 253, 0.1);
  }

  /* Live Tracking Preview */
  .tracking-preview {
    height: 180px;
    border-radius: 16px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.3);
  }

  .tracking-preview::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(
        circle at 20% 80%,
        rgba(255, 255, 255, 0.1) 0%,
        transparent 50%
      ),
      radial-gradient(
        circle at 80% 20%,
        rgba(255, 255, 255, 0.1) 0%,
        transparent 50%
      );
  }

  /* Responsive Adjustments */
  @media (max-width: 768px) {
    .tracking-container {
      padding: 1rem;
    }

    .tracking-input-enhanced,
    .btn-track-enhanced {
      padding: 1rem 1.25rem;
      font-size: 1rem;
    }

    .input-group-enhanced {
      flex-direction: column;
      border-radius: 16px;
    }

    .tracking-input-enhanced,
    .btn-track-enhanced {
      border-radius: 12px;
      width: 100%;
    }

    .tracking-input-enhanced {
      border-radius: 12px 12px 0 0;
      border-bottom: 1px solid #e9ecef;
    }

    .btn-track-enhanced {
      border-radius: 0 0 12px 12px;
    }
  }

  /* Animation */
  @keyframes pulse-subtle {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.7;
    }
  }

  .pulse-subtle {
    animation: pulse-subtle 2s ease-in-out infinite;
  }

  /* Enhanced Form Text */
  .form-helper {
    font-size: 0.85rem;
    color: #64748b;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* Quick Actions */
  .quick-action {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
    font-weight: 500;
    color: #475569;
    transition: all 0.2s ease;
  }

  .quick-action:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
    transform: translateY(-1px);
  }

  /* Grid Background */
  .grid-bg {
    background-image: linear-gradient(
        rgba(13, 110, 253, 0.03) 1px,
        transparent 1px
      ),
      linear-gradient(90deg, rgba(13, 110, 253, 0.03) 1px, transparent 1px);
    background-size: 30px 30px;
  }

  /* Floating Elements */
  .floating-element {
    position: absolute;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: radial-gradient(
      circle,
      rgba(13, 110, 253, 0.1) 0%,
      transparent 70%
    );
    pointer-events: none;
  }

  .floating-element-1 {
    top: 20%;
    left: 10%;
    animation: float 20s linear infinite;
  }

  .floating-element-2 {
    bottom: 30%;
    right: 15%;
    animation: float 25s linear infinite reverse;
  }

  @keyframes float {
    0%,
    100% {
      transform: translate(0, 0);
    }
    25% {
      transform: translate(20px, 20px);
    }
    50% {
      transform: translate(0, 40px);
    }
    75% {
      transform: translate(-20px, 20px);
    }
  }
</style>

<!-- Background Elements -->
<div class="floating-element floating-element-1"></div>
<div class="floating-element floating-element-2"></div>

<!-- Main Tracking Section -->
<section class="py-5 bg-pattern grid-bg" style="min-height: 100vh">
  <div class="tracking-container">
    <!-- Header -->
    <div class="text-center mb-5">
      <div class="d-flex justify-content-center gap-2 mb-3">
        <span class="status-badge pulse-subtle">
          <i class="fas fa-satellite"></i>
          <span>Live Tracking Active</span>
        </span>
        <span class="status-badge">
          <i class="fas fa-shield-alt"></i>
          <span>Enterprise Security</span>
        </span>
      </div>

      <h1
        class="display-5 fw-bold mb-3"
        style="
          background: linear-gradient(
            135deg,
            var(--primary-color),
            var(--secondary-color)
          );
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        "
      >
        Smart Delivery Tracking
      </h1>
      <p class="text-muted mb-4 fs-5" style="max-width: 600px; margin: 0 auto">
        Enter your tracking ID for AI-powered predictive analytics and real-time
        Mapbox visualization
      </p>
    </div>

    <!-- Main Tracking Card -->
    <div class="glass-card p-4 mb-5">
      <div class="row g-4 align-items-center">
        <div class="col-lg-8">
          <div class="d-flex align-items-center gap-3 mb-4">
            <div class="bg-primary bg-opacity-10 rounded-2 p-2">
              <i class="fas fa-qrcode text-primary fs-4"></i>
            </div>
            <div>
              <h3 class="fw-bold mb-1">Track Any Delivery</h3>
              <p class="text-muted mb-0 fs-6">
                Use your unique tracking ID for instant AI-powered tracking
              </p>
            </div>
          </div>

          <form id="trackingForm" onsubmit="handleTrackSubmit(event)">
            <div class="mb-4">
              <div class="input-group d-flex">
                <input
                  type="text"
                  id="trackingId"
                  name="trackingId"
                  class="form-control tracking-input-enhanced"
                  placeholder="DEL-51434020-X3RY"
                  pattern="^DEL-\d{8}-[A-Z0-9]{4}$"
                  title="Format: DEL-8 digits-4 characters (e.g., DEL-51434020-X3RY)"
                  required
                  autocomplete="off"
                  autocorrect="off"
                  spellcheck="false"
                />
                <button
                  class="btn btn-track-enhanced shadow-none"
                  type="submit"
                  id="submitBtn"
                >
                  <i class="fas fa-satellite-dish me-2"></i>Track Now
                </button>
              </div>

              <div
                class="d-flex flex-wrap justify-content-between align-items-center mt-3 gap-2"
              >
                <div class="form-helper">
                  <i class="fas fa-key text-primary"></i>
                  Format: DEL-XXXXXXXX-XXXX
                </div>
                <div class="d-flex gap-2">
                  <button
                    type="button"
                    class="quick-action"
                    onclick="pasteFromClipboard()"
                  >
                    <i class="fas fa-paste"></i>
                    Paste ID
                  </button>
                  <button
                    type="button"
                    class="quick-action"
                    onclick="generateSampleId()"
                  >
                    <i class="fas fa-magic"></i>
                    Generate Sample
                  </button>
                </div>
              </div>

              <!-- Error Container -->
              <div id="errorContainer" class="mt-3" style="display: none"></div>
            </div>
          </form>

          <!-- Recent Tracking -->
          <div class="mt-4"></div>
        </div>

        <div class="col-lg-4">
          <div
            class="tracking-preview d-flex flex-column justify-content-center align-items-center text-white p-4"
          >
            <div class="position-relative z-2 text-center">
              <div
                class="bg-white bg-opacity-20 rounded-circle p-3 mb-3 d-inline-flex text-dark"
              >
                <i class="fas fa-map-marked-alt fa-2x"></i>
              </div>
              <h5 class="fw-bold mb-2">Live AI Tracking</h5>
              <p class="opacity-90 mb-3 fs-7">
                Real-time predictive analytics with Mapbox visualization
              </p>
              <div
                class="badge bg-white bg-opacity-20 rounded-pill px-3 py-2 text-dark"
              >
                <i class="fas fa-bolt me-1"></i>
                AI-Powered
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="row g-3 mb-5">
      <div class="col-md-3 col-6">
        <div class="stats-card-compact text-center">
          <div class="text-primary mb-2">
            <i class="fas fa-clock fa-2x"></i>
          </div>
          <h4 class="fw-bold mb-1">30s</h4>
          <p class="text-muted mb-0 fs-7">Update Frequency</p>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="stats-card-compact text-center">
          <div class="text-success mb-2">
            <i class="fas fa-bullseye fa-2x"></i>
          </div>
          <h4 class="fw-bold mb-1">99.8%</h4>
          <p class="text-muted mb-0 fs-7">Accuracy Rate</p>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="stats-card-compact text-center">
          <div class="text-warning mb-2">
            <i class="fas fa-globe fa-2x"></i>
          </div>
          <h4 class="fw-bold mb-1">142+</h4>
          <p class="text-muted mb-0 fs-7">Countries</p>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="stats-card-compact text-center">
          <div class="text-info mb-2">
            <i class="fas fa-truck fa-2x"></i>
          </div>
          <h4 class="fw-bold mb-1">12.4k</h4>
          <p class="text-muted mb-0 fs-7">Active Fleet</p>
        </div>
      </div>
    </div>

    <!-- AI Processing Container -->
    <div id="aiProcessing" style="display: none"></div>

    <!-- Features Grid -->
    <div class="row g-4">
      <div class="col-md-4">
        <div class="glass-card p-4 h-100">
          <div
            class="bg-primary bg-opacity-10 rounded-2 p-3 d-inline-flex mb-3"
          >
            <i class="fas fa-robot text-primary fs-3"></i>
          </div>
          <h5 class="fw-bold mb-2">AI Predictions</h5>
          <p class="text-muted fs-7 mb-0">
            Machine learning algorithms predict delivery times with 99.2%
            accuracy using historical data.
          </p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="glass-card p-4 h-100">
          <div
            class="bg-success bg-opacity-10 rounded-2 p-3 d-inline-flex mb-3"
          >
            <i class="fas fa-map-marked-alt text-success fs-3"></i>
          </div>
          <h5 class="fw-bold mb-2">Live Maps</h5>
          <p class="text-muted fs-7 mb-0">
            Real-time Mapbox visualization with geocoding and route
            optimization.
          </p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="glass-card p-4 h-100">
          <div
            class="bg-warning bg-opacity-10 rounded-2 p-3 d-inline-flex mb-3"
          >
            <i class="fas fa-shield-alt text-warning fs-3"></i>
          </div>
          <h5 class="fw-bold mb-2">Enterprise Security</h5>
          <p class="text-muted fs-7 mb-0">
            Military-grade encryption and compliance with global security
            standards.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Enhanced JavaScript with modern features

  // Initialize
  document.addEventListener("DOMContentLoaded", function () {
    // Auto-focus tracking input
    const trackingInput = document.getElementById("trackingId");
    if (trackingInput) {
      setTimeout(() => trackingInput.focus(), 300);

      // Add input formatting
      trackingInput.addEventListener("input", function (e) {
        let value = e.target.value.toUpperCase();

        // Remove invalid characters
        value = value.replace(/[^A-Z0-9\-]/g, "");

        // Auto-format tracking ID
        if (value.startsWith("DEL") && value.length > 3 && value[3] !== "-") {
          value = "DEL-" + value.slice(3);
        }
        if (value.length > 12 && value[12] !== "-") {
          value = value.slice(0, 12) + "-" + value.slice(12);
        }

        // Limit length
        if (value.length > 17) {
          value = value.slice(0, 17);
        }

        e.target.value = value;

        // Update validation state
        validateInput(value);
      });
    }

    // Add keyboard shortcuts
    document.addEventListener("keydown", function (e) {
      // Ctrl/Cmd + K to focus tracking
      if ((e.ctrlKey || e.metaKey) && e.key === "k") {
        e.preventDefault();
        trackingInput?.focus();
        trackingInput?.select();
      }

      // Escape to clear
      if (e.key === "Escape" && document.activeElement === trackingInput) {
        trackingInput.value = "";
      }
    });
  });

  // Enhanced validation
  function validateInput(value) {
    const input = document.getElementById("trackingId");
    const pattern = /^DEL-\d{8}-[A-Z0-9]{4}$/;

    input.classList.remove("is-valid", "is-invalid");

    if (!value) return;

    if (pattern.test(value)) {
      input.classList.add("is-valid");
      showVisualFeedback("success", "âœ“ Valid format");
    } else if (value.length >= 3) {
      input.classList.add("is-invalid");
      showVisualFeedback("error", "Format: DEL-XXXXXXXX-XXXX");
    }
  }

  // Visual feedback
  function showVisualFeedback(type, message) {
    // Remove existing feedback
    const existing = document.querySelector(".input-feedback");
    if (existing) existing.remove();

    if (!message) return;

    const inputGroup = document.querySelector(".input-group-enhanced");
    const feedback = document.createElement("div");
    feedback.className = `input-feedback position-absolute start-0 w-100 mt-1 px-3 text-${
      type === "success" ? "success" : "danger"
    } fs-7`;
    feedback.style.top = "100%";
    feedback.innerHTML = `<i class="fas fa-${
      type === "success" ? "check-circle" : "exclamation-circle"
    } me-1"></i> ${message}`;

    inputGroup.style.position = "relative";
    inputGroup.appendChild(feedback);

    // Auto-remove after 3 seconds
    setTimeout(() => feedback.remove(), 3000);
  }

  // Enhanced paste function
  async function pasteFromClipboard() {
    try {
      const text = await navigator.clipboard.readText();
      const input = document.getElementById("trackingId");

      if (!text.trim()) {
        showNotification("Clipboard is empty", "warning");
        return;
      }

      // Clean and validate
      let cleaned = text.trim().toUpperCase().replace(/\s+/g, "");

      // Auto-add DEL- prefix if missing but pattern matches
      if (/^\d{8}-[A-Z0-9]{4}$/.test(cleaned)) {
        cleaned = "DEL-" + cleaned;
      }

      input.value = cleaned;
      input.focus();
      input.select();

      // Validate
      validateInput(cleaned);

      // Show success animation
      const btn = event.target.closest(".quick-action");
      if (btn) {
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Pasted!';
        btn.classList.add("btn-success");
        btn.classList.remove("btn-outline-primary");

        setTimeout(() => {
          btn.innerHTML = originalHTML;
          btn.classList.remove("btn-success");
          btn.classList.add("btn-outline-primary");
        }, 1500);
      }
    } catch (error) {
      showNotification(
        "Cannot access clipboard. Paste manually (Ctrl+V).",
        "error"
      );
      document.getElementById("trackingId")?.focus();
    }
  }

  // Sample ID functions
  function generateSampleId() {
    const samples = [
      "DEL-51434020-X3RY",
      "DEL-62389145-B8TZ",
      "DEL-98701234-K9LX",
      "DEL-34567890-P4QW",
    ];
    const randomId = samples[Math.floor(Math.random() * samples.length)];
    const input = document.getElementById("trackingId");
    input.value = randomId;
    input.focus();
    validateInput(randomId);

    showNotification(`Sample ID loaded: ${randomId}`, "info");
  }

  function useSample(id) {
    const input = document.getElementById("trackingId");
    input.value = id;
    input.focus();
    input.select();
    validateInput(id);
  }

  // Enhanced notification system
  function showNotification(message, type = "info") {
    const existing = document.querySelectorAll(".notification-toast");
    existing.forEach((n) => n.remove());

    const colors = {
      success: "linear-gradient(135deg, #10b981, #059669)",
      error: "linear-gradient(135deg, #ef4444, #dc2626)",
      warning: "linear-gradient(135deg, #f59e0b, #d97706)",
      info: "linear-gradient(135deg, #3b82f6, #1d4ed8)",
    };

    const notification = document.createElement("div");
    notification.className = "notification-toast position-fixed top-4 end-4";
    notification.style.zIndex = "9999";
    notification.innerHTML = `
      <div class="toast show" style="min-width: 300px; border-radius: 12px; overflow: hidden; border: none;">
        <div class="toast-header text-white" style="background: ${
          colors[type]
        }; padding: 0.75rem 1rem;">
          <strong class="me-auto">${type.toUpperCase()}</strong>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body bg-white" style="padding: 1rem;">
          ${message}
        </div>
      </div>
    `;

    document.body.appendChild(notification);

    // Auto-remove
    setTimeout(() => notification.remove(), type === "success" ? 3000 : 5000);

    // Add click to dismiss
    notification.querySelector(".btn-close").addEventListener("click", () => {
      notification.remove();
    });
  }

  // Form submission (existing functionality with enhancements)
  async function handleTrackSubmit(event) {
    event.preventDefault();

    const input = document.getElementById("trackingId");
    let trackingId = input.value.trim().toUpperCase();

    // Remove extra spaces
    trackingId = trackingId.replace(/\s+/g, "");

    // Validate
    const validationError = validateTrackingId(trackingId);
    if (validationError) {
      showNotification(validationError, "error");
      input.focus();
      input.select();
      return;
    }

    // Show loading state
    const btn = document.querySelector(".btn-track-enhanced");
    const originalContent = btn.innerHTML;
    btn.innerHTML = `
      <span class="spinner-grow spinner-grow-sm me-2"></span>
      AI Processing...
    `;
    btn.disabled = true;

    // Visual feedback
    input.style.borderColor = "#10b981";
    input.disabled = true;

    try {
      // Show AI processing
      showAIProcessing(trackingId);

      // Send request
      const response = await fetch("/delivery/track", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
          "X-Requested-With": "XMLHttpRequest",
        },
        body: new URLSearchParams({ trackingId }),
      });

      const data = await response.json();

      if (data.success) {
        completeAIProcessing();

        if (data.warning) {
          showNotification(data.warning, "warning");
          setTimeout(() => {
            showNotification("Redirecting to tracking...", "success");
          }, 1000);
        } else {
          showNotification("Tracking found! Redirecting...", "success");
        }

        setTimeout(() => {
          window.location.href = data.redirect;
        }, 1500);
      } else {
        resetFormState(btn, originalContent, input);
        showNotification(data.error || "Tracking not found", "error");
        hideAIProcessing();
      }
    } catch (error) {
      console.error("Network error:", error);
      resetFormState(btn, originalContent, input);
      showNotification("Network error. Please try again.", "error");
      hideAIProcessing();
    }
  }

  // AI Processing functions (keep existing functionality)
  function showAIProcessing(trackingId) {
    const container = document.getElementById("aiProcessing");
    if (!container) return;

    container.style.display = "block";
    container.innerHTML = `
      <div class="glass-card p-4 mt-4">
        <div class="ai-processing-animation">
          <div class="ai-header">
            <i class="fas fa-brain text-primary me-2"></i>
            <span class="fw-bold">AI Route Analysis in Progress</span>
            <small class="text-muted ms-2">${trackingId}</small>
          </div>
          <div class="ai-steps">
            <div class="ai-step active" data-step="1">
              <i class="fas fa-search me-2"></i>
              <span>Querying global database...</span>
            </div>
            <div class="ai-step" data-step="2">
              <i class="fas fa-microchip me-2"></i>
              <span>Analyzing route patterns...</span>
            </div>
            <div class="ai-step" data-step="3">
              <i class="fas fa-robot me-2"></i>
              <span>Calculating ETA with AI...</span>
            </div>
            <div class="ai-step" data-step="4">
              <i class="fas fa-map-marked-alt me-2"></i>
              <span>Generating real-time map...</span>
            </div>
          </div>
          <div class="ai-progress mt-3">
            <div class="progress" style="height: 6px;">
              <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 25%"></div>
            </div>
          </div>
        </div>
      </div>
    `;

    // Animate steps
    let step = 1;
    const steps = container.querySelectorAll(".ai-step");
    const progressBar = container.querySelector(".progress-bar");

    const interval = setInterval(() => {
      if (step <= 4) {
        if (step > 1) {
          steps[step - 2].classList.remove("active");
        }
        if (steps[step - 1]) {
          steps[step - 1].classList.add("active");
          progressBar.style.width = `${(step / 4) * 100}%`;
        }
        step++;
      } else {
        clearInterval(interval);
      }
    }, 600);
  }

  function completeAIProcessing() {
    const container = document.getElementById("aiProcessing");
    if (container) {
      const progressBar = container.querySelector(".progress-bar");
      if (progressBar) {
        progressBar.style.width = "100%";
        progressBar.classList.remove("progress-bar-animated");
        progressBar.classList.add("bg-success");
      }

      setTimeout(() => {
        container.innerHTML = `
          <div class="glass-card p-4 mt-4 text-center">
            <i class="fas fa-check-circle text-success fa-3x mb-3"></i>
            <h5 class="fw-bold mb-2">Analysis Complete!</h5>
            <p class="text-muted">Redirecting to tracking results...</p>
          </div>
        `;
      }, 500);
    }
  }

  function hideAIProcessing() {
    const container = document.getElementById("aiProcessing");
    if (container) {
      container.style.display = "none";
      container.innerHTML = "";
    }
  }

  function resetFormState(btn, originalContent, input) {
    btn.innerHTML = originalContent;
    btn.disabled = false;
    input.disabled = false;
    input.style.borderColor = "";
  }

  // Validation helper
  function validateTrackingId(trackingId) {
    const pattern = /^DEL-\d{8}-[A-Z0-9]{4}$/;

    if (!pattern.test(trackingId)) {
      if (!trackingId.startsWith("DEL-")) {
        return 'Tracking ID must start with "DEL-"';
      }

      const parts = trackingId.split("-");
      if (parts.length !== 3) {
        return "Format: DEL-8 digits-4 characters (e.g., DEL-51434020-X3RY)";
      }

      if (parts[1].length !== 8 || !/^\d{8}$/.test(parts[1])) {
        return "Middle part must be 8 digits";
      }

      if (parts[2].length !== 4 || !/^[A-Z0-9]{4}$/.test(parts[2])) {
        return "Last part must be 4 alphanumeric characters";
      }

      return "Invalid tracking ID format";
    }

    return null;
  }

  // Add CSS for animations if not already present
  if (!document.querySelector("#tracking-styles")) {
    const style = document.createElement("style");
    style.id = "tracking-styles";
    style.textContent = `
      @keyframes progress-bar-stripes {
        0% { background-position: 1rem 0; }
        100% { background-position: 0 0; }
      }
      
      .progress-bar-striped {
        background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
        background-size: 1rem 1rem;
      }
      
      .progress-bar-animated {
        animation: progress-bar-stripes 1s linear infinite;
      }
      
      .ai-step {
        opacity: 0.6;
        transition: all 0.3s ease;
      }
      
      .ai-step.active {
        opacity: 1;
        color: #0d6efd;
        font-weight: 600;
      }
    `;
    document.head.appendChild(style);
  }
</script>
